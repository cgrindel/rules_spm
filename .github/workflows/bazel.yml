name: Build

on:
  pull_request:
    branches: [ main ]

jobs:
  # macos_build:

  #   runs-on: macos-11.0

  #   steps:
  #   - uses: actions/checkout@v2

  #   - name: Write local.bazelrc File
  #     shell: bash
  #     run: |
  #       cat >local.bazelrc <<EOF
  #       common --config=ci
  #       EOF

  #   - name: Output the Bazel Info
  #     shell: bash
  #     run: |
  #       bazelisk info

  #   - name: Execute Tests
  #     shell: bash
  #     run: |
  #       bazelisk test //... 

  #   - name: Build Anything Not Tested
  #     shell: bash
  #     run: |
  #       bazelisk build //... 

  #   - name: Test Simple Example
  #     shell: bash
  #     run: |
  #       cd examples/simple
  #       bazelisk test //...

  #   - name: Test Package With Shared Deps Example
  #     shell: bash
  #     run: |
  #       cd examples/package_with_shared_deps
  #       bazelisk test //...

  #   - name: Test Vapor Example
  #     shell: bash
  #     run: |
  #       cd examples/vapor
  #       bazelisk test //...

  #   - name: Test iOS Simulator Example
  #     shell: bash
  #     run: |
  #       cd examples/ios_sim
  #       bazelisk test //...

  ubuntu_build:

    runs-on: ubuntu-20.04

    env:
      CC: clang

    steps:
    - uses: actions/checkout@v2

    - name: Install Prerequisites
      shell: bash
      run: |
        swift --version

    - name: Write local.bazelrc File
      shell: bash
      run: |
        cat >local.bazelrc <<EOF
        common --config=ci
        EOF

    - name: Output the Bazel Info
      shell: bash
      run: |
        bazelisk info

    - name: Execute Tests
      shell: bash
      run: |
        bazelisk test //... 

    - name: Build Anything Not Tested
      shell: bash
      run: |
        bazelisk build //... 

    - name: Test Simple Example
      shell: bash
      run: |
        cd examples/simple
        bazelisk test //... --verbose_failures --sandbox_debug

    - name: Test Package With Shared Deps Example
      shell: bash
      run: |
        cd examples/package_with_shared_deps
        bazelisk test //...

    - name: Test Vapor Example
      shell: bash
      run: |
        cd examples/vapor
        bazelisk test //...
